<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="基础命令display查看当前所有配置 1display current-configuration 查看当前系统软件的版本 1display version ?命令补全和提示，输入？可以看到当前可用的命令集合 debugging打开所有调试开关 1debugging 关闭所有调试开关 1undo debugging 数据链路层实验冲突域所有彼此竞争以太网带宽的机器在同一冲突域上 集线器工作在物理">
<meta property="og:type" content="article">
<meta property="og:title" content="北航计网实验复习">
<meta property="og:url" content="http://yoursite.com/2022/11/20/北航计网实验复习/index.html">
<meta property="og:site_name" content="Jameci&#39;s Blog">
<meta property="og:description" content="基础命令display查看当前所有配置 1display current-configuration 查看当前系统软件的版本 1display version ?命令补全和提示，输入？可以看到当前可用的命令集合 debugging打开所有调试开关 1debugging 关闭所有调试开关 1undo debugging 数据链路层实验冲突域所有彼此竞争以太网带宽的机器在同一冲突域上 集线器工作在物理">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/images/北航计网实验复习/0.png">
<meta property="og:image" content="http://yoursite.com/images/北航计网实验复习/1.png">
<meta property="og:updated_time" content="2022-11-23T16:28:03.303Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="北航计网实验复习">
<meta name="twitter:description" content="基础命令display查看当前所有配置 1display current-configuration 查看当前系统软件的版本 1display version ?命令补全和提示，输入？可以看到当前可用的命令集合 debugging打开所有调试开关 1debugging 关闭所有调试开关 1undo debugging 数据链路层实验冲突域所有彼此竞争以太网带宽的机器在同一冲突域上 集线器工作在物理">
<meta name="twitter:image" content="http://yoursite.com/images/北航计网实验复习/0.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2022/11/20/北航计网实验复习/">





  <title>北航计网实验复习 | Jameci's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jameci's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">天下雷行，物与无妄。先王以茂对时，育万物。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/11/20/北航计网实验复习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jameci">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jameci's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">北航计网实验复习</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-11-20T23:09:30+08:00">
                2022-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><h2 id="display"><a href="#display" class="headerlink" title="display"></a>display</h2><p>查看当前所有配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display current-configuration</span><br></pre></td></tr></table></figure>
<p>查看当前系统软件的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display version</span><br></pre></td></tr></table></figure>
<h2 id><a href="#" class="headerlink" title="?"></a>?</h2><p>命令补全和提示，输入？可以看到当前可用的命令集合</p>
<h2 id="debugging"><a href="#debugging" class="headerlink" title="debugging"></a>debugging</h2><p>打开所有调试开关</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugging</span><br></pre></td></tr></table></figure>
<p>关闭所有调试开关</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undo debugging</span><br></pre></td></tr></table></figure>
<h1 id="数据链路层实验"><a href="#数据链路层实验" class="headerlink" title="数据链路层实验"></a>数据链路层实验</h1><h2 id="冲突域"><a href="#冲突域" class="headerlink" title="冲突域"></a>冲突域</h2><p>所有彼此竞争以太网带宽的机器在同一冲突域上</p>
<p>集线器工作在物理层，单纯转发信号，所有连在同一台集线器上的主机在同一个冲突域</p>
<p>交换机工作在链路层，冲突域只有一个端口，所以说交换机能隔离冲突域</p>
<h2 id="广播域"><a href="#广播域" class="headerlink" title="广播域"></a>广播域</h2><p>广播报文会在同一网段上广播，路由器或者第三层交换机可以隔离广播域</p>
<h2 id="MAC表和ARP表"><a href="#MAC表和ARP表" class="headerlink" title="MAC表和ARP表"></a>MAC表和ARP表</h2><h3 id="ARP表"><a href="#ARP表" class="headerlink" title="ARP表"></a>ARP表</h3><h4 id="ARP表的作用"><a href="#ARP表的作用" class="headerlink" title="ARP表的作用"></a>ARP表的作用</h4><p>当一台主机要向同一链路层的另一台主机发送报文时，需要知道对方的mac地址作为目的mac地址</p>
<p>ARP表就是主机内部维护的表，记录着ip地址和mac地址的对应关系</p>
<h4 id="ARP表的形成"><a href="#ARP表的形成" class="headerlink" title="ARP表的形成"></a>ARP表的形成</h4><p>当同一网段的主机A要发报文给B，A会：</p>
<p>1.查看自己的ARP表，看B的ip对应的是哪个mac地址</p>
<p>2.若查到，进6，否则进3</p>
<p>3.A发布ARP广播，询问谁的ip地址是B，并附带自己的ip地址，mac地址，进4</p>
<p>4.B收到广播，发送ARP回复报文单独回复A，告诉A自己的mac地址，进5</p>
<p>5.A收到报文，向自己的ARP表中添加表项，进6</p>
<p>6.A将目的mac地址填入报文，发送</p>
<h3 id="MAC表"><a href="#MAC表" class="headerlink" title="MAC表"></a>MAC表</h3><p>MAC表是交换机内部的表，是决定交换机收到报文后向谁转发的</p>
<h4 id="MAC表的作用"><a href="#MAC表的作用" class="headerlink" title="MAC表的作用"></a>MAC表的作用</h4><p>交换机收到报文后</p>
<p>1.查找MAC表里有没有改目的MAC地址的表项，有则进3，否则进2</p>
<p>2.交换机向除来源之外的所有口转发</p>
<p>3.查看该项是不是来源自己，若是，说明是来源内部的通信没必要转发；若不是，向该项转发</p>
<h4 id="MAC表的学习"><a href="#MAC表的学习" class="headerlink" title="MAC表的学习"></a>MAC表的学习</h4><p>每当交换机收到报文，都会看自己的MAC表里有没有存储该来源端口和来源MAC地址之间的对应关系，若没存就存一个</p>
<p>每条记录都会有过期时间</p>
<h2 id="划分Vlan"><a href="#划分Vlan" class="headerlink" title="划分Vlan"></a>划分Vlan</h2><h3 id="三种不同属性的端口"><a href="#三种不同属性的端口" class="headerlink" title="三种不同属性的端口"></a>三种不同属性的端口</h3><p>Access连接不支持vlan技术的端口</p>
<p>Trunk连接支持vlan技术的端口</p>
<p>Hybrid是两种都可以连的</p>
<p>默认vlan：是指所有端口都带有的一个vlan属性，其值为pvid，默认所有端口都属于vlan1，pvid是1，并且vlan1是untagged的</p>
<p>untagged和tagged：端口的一个vlan属性，用来确定从该端口发出的数据帧带不带标签。Access默认是untagged，Trunk默认除了默认vlan之外所有都是是tagged，Hybrid可以对某个vlan指定它带不带tag</p>
<p>这里说的发出是指离开交换机，即使是交换机一个untagged口接收到报文，不出交换机给另外一个端口时，也是会打上tag的</p>
<h3 id="转发帧"><a href="#转发帧" class="headerlink" title="转发帧"></a>转发帧</h3><p>1.接到一个数据帧，检查</p>
<p>2.若带vlan标签，进3，不带进4</p>
<p>3.若带有的vlan标签和本端口的vlan标签一致，进5，否则，进8</p>
<p>4.为该帧打上默认pvid的vlan标签，进3</p>
<p>5.根据该帧的原mac地址更新mac表，之后查看目的mac地址，找mac表，交给相应的端口，进6</p>
<p>6.对应端口接到后，先决定允不允许转发带该vlan的帧，若是进7，不是进8</p>
<p>7.根据该vlan在自己这里带不带tag决定去不去掉其tag，并转发</p>
<p>8.丢弃该帧</p>
<h3 id="vlan配置命令"><a href="#vlan配置命令" class="headerlink" title="vlan配置命令"></a>vlan配置命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">创建vlan</span><br><span class="line">vlan 2</span><br><span class="line"></span><br><span class="line">删除vlan</span><br><span class="line">undo vlan 2</span><br><span class="line"></span><br><span class="line">向某个vlan添加端口/将某个端口绑定到vlan</span><br><span class="line">vlan 2</span><br><span class="line">port e 0/0/0 e 0/0/1</span><br><span class="line"></span><br><span class="line">删除端口</span><br><span class="line">undo port e 0/0/0 e 0/0/1</span><br><span class="line"></span><br><span class="line">指定某个端口的类型</span><br><span class="line">interface e 0/0/0</span><br><span class="line">port link-type &#123;access|trunk|hybrid&#125;</span><br><span class="line"></span><br><span class="line">指定默认vlan id</span><br><span class="line">interface e 0/0/0</span><br><span class="line">port trunk pvid vlan 2</span><br><span class="line">port trurk pvid vlan 3</span><br><span class="line"></span><br><span class="line">指定/删除trunk端口可以通过的trunk数据帧</span><br><span class="line">interface e 0/0/0</span><br><span class="line">port trunk permit vlan 2 to 3</span><br><span class="line">port trunk permit vlan 20 30</span><br><span class="line"></span><br><span class="line">将hybrid端口加入到已经存在的vlan，并设置为untagged</span><br><span class="line">interface e 0/0/0</span><br><span class="line">port hybrid untagged vlan 20 30</span><br></pre></td></tr></table></figure>
<h2 id="PPP协议分析"><a href="#PPP协议分析" class="headerlink" title="PPP协议分析"></a>PPP协议分析</h2><h1 id="网络层实验"><a href="#网络层实验" class="headerlink" title="网络层实验"></a>网络层实验</h1><h2 id="2，3层综合实验"><a href="#2，3层综合实验" class="headerlink" title="2，3层综合实验"></a>2，3层综合实验</h2><p><img src="/images/北航计网实验复习/0.png" alt></p>
<p>把中间的g 0/0/13口配置成trunk，并且允许v2v3通过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">port link-type trunk</span><br><span class="line">port trunk allow-pass vlan 2 3</span><br></pre></td></tr></table></figure>
<p>c向d发送ping报文</p>
<p>1.c发报文时，发现目的地址192.168.3.11和自己不在同一网段，于是给网关192.168.2.1</p>
<p>2.c并不知道网关的mac地址，所以，c先发送了arp报文，源ip为192.168.2.11，源mac为c的mac，目的ip为192.168.2.1，目的mac是广播地址全一</p>
<p>3.s2收到arp报文，先更新其mac地址表，记录e0/1口对应c的mac</p>
<p>4.s2向所有vlan 2的口转发arp报文，并添加其vlan id为2</p>
<p>5.s1接到报文，更新mac表，记录e0/13对应c的mac</p>
<p>6.s1发现报文的目的地址是自己vlan 2的ip，便准备一份回复，带有自己的mac地址，目的mac填c的mac，vlan id = 2</p>
<p>7.s1查找mac表，发现对应口e0/13，就发出</p>
<p>8.s2收到报文，更新mac表，记录e0/13对应的s1的mac</p>
<p>9.s2根据vlan标签和mac表，将该回复给c，去掉vlan标签</p>
<p>10.c写入自己的arp表，然后发出ping报文，目的mac为s1的mac，vlan id = 0</p>
<p>11.s2收到ping报文，根据e0/1口的vlan打上标签2，在mac表查找目的mac地址，知道该往e0/13发</p>
<p>12.s1收到ping报文，查看目的ip地址在自己的网段内，是去往vlan 3的，就准备转发，查找mac表，但找不到d</p>
<p>13.s1就发送arp广播，vlan id为3</p>
<p>14.s2接到arp广播，向所有vlan 3口转发该帧</p>
<p>15.d收到该帧，更新自己的arp表，即192.168.3.1对应的s1的mac</p>
<p>16.d发送回复，不带vlan id，目的为s1</p>
<p>17.s2收到回复，更新自己的mac表，e0/24对应d的mac</p>
<p>18.s2根据来的端口对应vlan，为此报文打上vlan id = 3，查找mac表知道该往e 0/13口转发</p>
<p>19.s1收到了回复，更新自己的mac表，知道d的mac地址对应端口e 0/13</p>
<p>20.s1把ping报文转发出去，目的mac为d的mac，vlan id = 3</p>
<p>21.s2收到ping报文，根据目的mac和vlan id查表，发现该往e 0/24口发</p>
<p>22.s2的e 0/24口是untagged，就去掉vlan id，发给d</p>
<p>23.d收到ping报文，回复，目的地址为网关的ip 192.168.3.1，查找arp表找到对应s1的mac为目的mac</p>
<p>24.d的reply发给s2，s2根据来源为其打上vlan 3，查找mac表知道该走e 0/13口</p>
<p>25.s1收到reply，目的ip是自己vlan 2的网段，便查找mac表，找到目的ip对应的目的mac地址，打上vlan 2的标签，转发，目的mac为c的mac</p>
<p>26.s2收到reply，此时的vlan id = 2，查找mac表知道c该往e 0/1发</p>
<p>27.e 0/1去掉vlan标签，发给c</p>
<p>28.c收到reply</p>
<h1 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h1><h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">重启ospf</span><br><span class="line">&lt;h3c&gt;reset ospf process</span><br><span class="line"></span><br><span class="line">显示ospf邻居信息</span><br><span class="line">[ospf]display ospf peer</span><br><span class="line"></span><br><span class="line">停止ospf</span><br><span class="line">[h3c]undo ospf 1</span><br><span class="line"></span><br><span class="line">显示ospf路由表信息</span><br><span class="line">[ospf]display ospf routing</span><br><span class="line"></span><br><span class="line">查看lsa</span><br><span class="line">display ospf lsdb</span><br><span class="line"></span><br><span class="line">查看不同类型的lsa</span><br><span class="line">display ospf lsdb router</span><br><span class="line">display ospf lsdb summary</span><br><span class="line">display ospf lsdb asbr</span><br><span class="line">display ospf lsdb ase</span><br></pre></td></tr></table></figure>
<h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2><h3 id="router-id"><a href="#router-id" class="headerlink" title="router id"></a>router id</h3><p>router id是ospf协议里识别一台路由器的标识，通常人为指定为某个loopback地址</p>
<p>若不指定，默认为最大的loopback地址，若无loopback，默认为最大的物理地址</p>
<p>新的router id要生效需要重启ospf</p>
<h3 id="ospf多进程"><a href="#ospf多进程" class="headerlink" title="ospf多进程"></a>ospf多进程</h3><p>同一台路由器上的ospf进程可以有多个，用进程号区分，默认为1</p>
<h2 id="五种报文类型"><a href="#五种报文类型" class="headerlink" title="五种报文类型"></a>五种报文类型</h2><p>ospf要求工作在ip层上，要求可靠传输，是自己通过协议实现的</p>
<h3 id="Hello"><a href="#Hello" class="headerlink" title="Hello"></a>Hello</h3><p>周期性发给邻居，包括定时器的数值，DR和BDR，以及已知的邻居</p>
<h3 id="DD报文"><a href="#DD报文" class="headerlink" title="DD报文"></a>DD报文</h3><p>交换邻居路由器之间的链路状态数据库摘要信息</p>
<p>在最开始，两个邻居路由器相互发送空的DD报文来确认主从关系</p>
<h3 id="LSR报文"><a href="#LSR报文" class="headerlink" title="LSR报文"></a>LSR报文</h3><p>两台路由器交换了DD报文之后，通过对比发现自己的缺少的LSA和需要更新的LSR，这时就需要发送LSR报文，请求需要的LSA，此时报文的内容为缺少的LSA的摘要</p>
<h3 id="LSU报文"><a href="#LSU报文" class="headerlink" title="LSU报文"></a>LSU报文</h3><p>用来向发送LSR报文的路由器发送其所需要的LSA，发送的报文是多条LSA的集合</p>
<h3 id="LSAac报文"><a href="#LSAac报文" class="headerlink" title="LSAac报文"></a>LSAac报文</h3><p>对收到的LSU报文的确认，内容是需要确认的LSA的首部</p>
<h2 id="邻居状态机"><a href="#邻居状态机" class="headerlink" title="邻居状态机"></a>邻居状态机</h2><h3 id="Down"><a href="#Down" class="headerlink" title="Down"></a>Down</h3><p>初始状态，过去的Dead-Interval内没有收到hello报文</p>
<h3 id="Attempt"><a href="#Attempt" class="headerlink" title="Attempt"></a>Attempt</h3><p>Attempt只适用于NBMA类型的接口，处于此状态，定期向那些手工配置的邻居发送hello</p>
<h3 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h3><p>收到邻居的hello，但该报文列出的邻居中没有本路由器的router id(对方未发现自己)</p>
<h3 id="2-way"><a href="#2-way" class="headerlink" title="2-way"></a>2-way</h3><p>双方收到了彼此的hello，建立了邻居状态</p>
<h3 id="ExStart"><a href="#ExStart" class="headerlink" title="ExStart"></a>ExStart</h3><p>由2-way状态转变而来，在此状态下互相交换DD报文来确定主从关系</p>
<h3 id="ExChang"><a href="#ExChang" class="headerlink" title="ExChang"></a>ExChang</h3><p>确立主从关系后，互相发送带有本地路由摘要的DD报文</p>
<h3 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a>Loading</h3><p>此状态下，请求对方的LSU报文</p>
<h3 id="Full"><a href="#Full" class="headerlink" title="Full"></a>Full</h3><p>相互信息共享完毕，建立邻接关系</p>
<h3 id="状态转移图"><a href="#状态转移图" class="headerlink" title="状态转移图"></a>状态转移图</h3><p><img src="/images/北航计网实验复习/1.png" alt></p>
<h3 id="报文交互过程"><a href="#报文交互过程" class="headerlink" title="报文交互过程"></a>报文交互过程</h3><h4 id="Hello发现邻居"><a href="#Hello发现邻居" class="headerlink" title="Hello发现邻居"></a>Hello发现邻居</h4><p>1.一个路由器R1向邻居R2发送hello报文，此时它未发现任何邻居，所以hello报文里的Neighbor字段为空</p>
<p>2.邻居R2收到hello，创建邻居R1，将R1状态设为Init，回复hello，Neighbor里带上R1，表示收到了R1的hello</p>
<p>3.R1接到回复，创建邻居R2，将R2状态设为ExStart</p>
<h4 id="主从关系协商"><a href="#主从关系协商" class="headerlink" title="主从关系协商"></a>主从关系协商</h4><p>由于ospf要求可靠传输，但ip不可靠，因此，其主从机制就是为了解决这一问题。宣称为Master的路由器会定义一个序列号Seq，每次发送一个DD报文时，序列号都会加一。Slave路由器回复时，带有收到的最大序列号</p>
<p>4.R1发送只有首部的空DD报文，MS=1宣称自己是Master，规定初始序列号x</p>
<p>5.R2收到DD报文后，先将R1的状态设置为ExStart，并比较R1和自己的router id，如果自己的较大，则发送DD报文MS=1宣称自己是Master，并且重新给出序列号y</p>
<p>6.R1收到，比较后承认R2为Master，并将R2的状态设为Exchange</p>
<h4 id="DD报文交换"><a href="#DD报文交换" class="headerlink" title="DD报文交换"></a>DD报文交换</h4><p>7.R1用R2的序列号发送新的DD报文，MS=0表明自己是Slave，报文中携带R1内部LSDB中的LSA的摘要</p>
<p>8.R2收到，将R1状态改为ExChange，发送DD报文，MS=1，并且携带R2内部LSDB的LSA摘要</p>
<p>9.重复7，8，R2每发一个DD报文，Seq+1，R1的DD报文Seq号始终等于最新收到的R2报文Seq值，直到所有DD报文发完，R2最后一个DD报文的MS=0表示最后</p>
<p>10.R1收到R2最后一个报文，比较发现很多LSA自己没有，将R2的状态设置为Loading</p>
<p>11.R2收到R1最后一个报文，比较发现都有，之间把R1设为Full</p>
<h4 id="LSA请求"><a href="#LSA请求" class="headerlink" title="LSA请求"></a>LSA请求</h4><p>12.R1向R2发送LSR报文请求LSA，内容是所需要的LSA摘要，并非所有</p>
<h4 id="LSA更新"><a href="#LSA更新" class="headerlink" title="LSA更新"></a>LSA更新</h4><p>13.R2用LSU报文来回答R1的请求</p>
<h4 id="LSA应答"><a href="#LSA应答" class="headerlink" title="LSA应答"></a>LSA应答</h4><p>14.R1收到LSU报文，将R2设为Full，发送LSAck报文来应答</p>
<h2 id="OSPF的网络类型"><a href="#OSPF的网络类型" class="headerlink" title="OSPF的网络类型"></a>OSPF的网络类型</h2><h3 id="广播类型"><a href="#广播类型" class="headerlink" title="广播类型"></a>广播类型</h3><p>链路层协议是Ethernet、FDDI，类型为Broadcast</p>
<p>通常以组播224.0.0.5、224.0.0.6发送报文，需要选举指定路由器DR和备份指定路由器BDR</p>
<h3 id="NBMA类型"><a href="#NBMA类型" class="headerlink" title="NBMA类型"></a>NBMA类型</h3><p>链路使用帧中继，ATM或X.25协议，类型为NBMA</p>
<p>这种网络使用单播，手工指定邻居，选举DR和BDR，要求他们和DRouter直连</p>
<h3 id="PTMP类型"><a href="#PTMP类型" class="headerlink" title="PTMP类型"></a>PTMP类型</h3><p>使用帧中间，ARM或X.25，但不是非广播多点可达网络NBMA</p>
<p>这种网络自动发现邻居，用组播224.0.0.5发协议报文，不要求DR/BDR选举</p>
<h3 id="点到点PTP类型"><a href="#点到点PTP类型" class="headerlink" title="点到点PTP类型"></a>点到点PTP类型</h3><p>协议是PPP，HDLC或LAPB，默认网络类型是PTP</p>
<p>以224.0.0.5发协议报文，无需选举DR/BDR</p>
<h2 id="链路状态描述"><a href="#链路状态描述" class="headerlink" title="链路状态描述"></a>链路状态描述</h2><p>链路状态报文LSA，下面三种网络都使用第一类LSA报文描述</p>
<h3 id="Stub-net"><a href="#Stub-net" class="headerlink" title="Stub net"></a>Stub net</h3><p>指所连接的是一个末端网络，该网段中没有其它运行OSPF协议的网络设备，只有计算机这样的设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">link id:10.0.0.0 //网络号</span><br><span class="line">data:255.0.0.0 //掩码</span><br><span class="line">type:StubNet(3) //类型为末端网络</span><br><span class="line">metric:50 //花销</span><br></pre></td></tr></table></figure>
<h3 id="PPP"><a href="#PPP" class="headerlink" title="PPP"></a>PPP</h3><p>点到点的链路连接另一台运行ospf的路由器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">相连网段</span><br><span class="line">link id:20.0.0.0 </span><br><span class="line">data:255.0.0.0</span><br><span class="line">type:StubNet(3)</span><br><span class="line">metric:5</span><br><span class="line"></span><br><span class="line">相连路由器</span><br><span class="line">link id:10.0.0.0 //路由器router id</span><br><span class="line">data:20.0.0.2 //连接该路由器的端口</span><br><span class="line">type:Router(1) //类型:路由器</span><br><span class="line">metric:50</span><br></pre></td></tr></table></figure>
<h3 id="点到多点"><a href="#点到多点" class="headerlink" title="点到多点"></a>点到多点</h3><p>彼此之间并非全联通，我到他们可以，他们之间不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">相连网段</span><br><span class="line">link id:40.0.0.1</span><br><span class="line">data:255.0.0.0</span><br><span class="line">type:StubNet(3)</span><br><span class="line">metric:5</span><br><span class="line"></span><br><span class="line">相连路由器</span><br><span class="line">link id:3.3.3.3</span><br><span class="line">data:40.0.0.1</span><br><span class="line">type:Router(1)</span><br><span class="line">metric:50</span><br><span class="line"></span><br><span class="line">相连路由器</span><br><span class="line">link id:4.4.4.4</span><br><span class="line">data:40.0.0.1</span><br><span class="line">type:Router(1)</span><br><span class="line">metric:50</span><br></pre></td></tr></table></figure>
<h2 id="第二类LSA和DR选举"><a href="#第二类LSA和DR选举" class="headerlink" title="第二类LSA和DR选举"></a>第二类LSA和DR选举</h2><p>对全连接网络(N个路由器的全连接广播或NBMA网络)用上述的第一类LSA会存在严重冗余和极大的流量消耗</p>
<p>为此，ospf自动选举一台DR和BDR，DR代表同一网段的所有路由器，所有路由器和DR互发信息，DR坏了就换BDR，并重新选BDR</p>
<h3 id="DR选举"><a href="#DR选举" class="headerlink" title="DR选举"></a>DR选举</h3><p>路由器的每个端口都有Priority，通过hello报文交换后，挑Priority最高的作为DR，若一样，则挑ip最大的</p>
<p>DR一旦选定，除非坏了否则不变，即使后来了ip更大的，也不再换DR了</p>
<h3 id="全连接网络描述"><a href="#全连接网络描述" class="headerlink" title="全连接网络描述"></a>全连接网络描述</h3><p>普通路由器还是使用第一类LSA描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">link id: 30.0.0.3 //DR的地址</span><br><span class="line">data:30.0.0.1 //本路由器的地址</span><br><span class="line">type:TransNet(2) //类型</span><br><span class="line">metric:50</span><br></pre></td></tr></table></figure>
<p>DR路由器用第二类LSA描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Net mask: 255.0.0.0 //本网段掩码</span><br><span class="line">Attached 30.0.0.1 router //本网段所有的主机router id</span><br><span class="line">Attached 30.0.0.2 router</span><br><span class="line">Attached 30.0.0.3 router</span><br></pre></td></tr></table></figure>
<h2 id="链路状态通告LSA的结构"><a href="#链路状态通告LSA的结构" class="headerlink" title="链路状态通告LSA的结构"></a>链路状态通告LSA的结构</h2><h3 id="首部"><a href="#首部" class="headerlink" title="首部"></a>首部</h3><p>首部定长，包含了产生时间，类型，发送者，Link State ID等等</p>
<h3 id="主体"><a href="#主体" class="headerlink" title="主体"></a>主体</h3><p>主体首先是Count字段，表示LSA到底有几条，之后包含多条LSA，不同类型的LSA描述不同，如上面所说的两类LSA</p>
<h2 id="区域划分"><a href="#区域划分" class="headerlink" title="区域划分"></a>区域划分</h2><p>运行ospf的路由器多了，链路信息数据库lsdb会非常大，一条路坏了要通知所有路由器，负担很重</p>
<p>解决方法是划分区域，区域id是一个32位整数</p>
<p>区域内的网络用第一和第二类LSA来描述，并仅在区域内部传播</p>
<p>区域边界的路由器会将此区域的路由用第三类LSA发出去</p>
<h3 id="路由器的类型"><a href="#路由器的类型" class="headerlink" title="路由器的类型"></a>路由器的类型</h3><p>根据路由器在AS中的位置，分为</p>
<p>IAR，区域内路由器，只属于一个区域，只保存一个LSDB</p>
<p>ABR，区域边界路由器，必须有一个是连接区域是area 0，可以是物理连接也可以是虚连接，为每个区域保存一个LSDB</p>
<p>并根据需要生成，Network Summary LSA(type = 3)，ASBR Summary LSA(type = 4)</p>
<p>BBR，骨干路由器，至少有一个接口处于area 0</p>
<p>ASBR，自治系统边界路由器</p>
<h3 id="学习AS外部路由"><a href="#学习AS外部路由" class="headerlink" title="学习AS外部路由"></a>学习AS外部路由</h3><p>ASBR会为从外部引入的每一条路由生成一条type = 5的LSA，并在AS内部传播，计算路由时先找到ASBR的位置，其它节点都当作叶子挂在ASBR的外面</p>
<p>为了到防止ASBR的LSA被ABR过滤，规定区域内的ABR为该区域的ASBR单独生成一条type 4类型的LSA，内容主要包括这个ASBR的Router id和cost</p>
<h3 id="骨干区域"><a href="#骨干区域" class="headerlink" title="骨干区域"></a>骨干区域</h3><p>如果各区域是平等的，那么按照上述由ABR通知其它区域的方式会产生自环</p>
<p>比如area 1的路由器A告诉area 2的B一条路由，B将其告诉了area 3的C</p>
<p>area 3的C恰巧也连着area 1，但C只知道这条路由是B告诉它的，不知道这是从area 1出来的，所有也会告诉aera 1网络里的路由器</p>
<p>area 1网络里的路由器也只知道这是C告诉的，就形成了环</p>
<p>解决方法是强制设定一个骨干区域area 0，规定所有区域都必须直接与area 0连接，并且area 0内部也是连通的。每个ASR连接的区域至少有一个是骨干区域，所有ASR将非骨干区域的LSA封装好并发给骨干区域，骨干区域将这些信息再发给非骨干区域</p>
<p>这样，每个三类LSA都知道其来源路由，也没传出两个区域，就避免了环</p>
<h3 id="虚连接"><a href="#虚连接" class="headerlink" title="虚连接"></a>虚连接</h3><p>虚连接是指实际上无法满足两个条件，即骨干区域无法连通，或者有非骨干区域无法与骨干区域直接连接时，可以配置虚连接使其视作直接连通</p>
<h3 id="三类LSA"><a href="#三类LSA" class="headerlink" title="三类LSA"></a>三类LSA</h3><p>首部LS Type为3</p>
<p>Link State ID为目的网络</p>
<p>Advertising Router是发布者</p>
<p>描述只有子网掩码，和指定了tos的花费值</p>
<h3 id="四类和五类"><a href="#四类和五类" class="headerlink" title="四类和五类"></a>四类和五类</h3><p>引入外部路由，使路由器变成ASBR的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip route-static 1.1.1.1 24</span><br><span class="line">ospf</span><br><span class="line">import-route static</span><br></pre></td></tr></table></figure>
<p>四类比较简单</p>
<p>Ls id为ASBR的id，adv id为发布者id，主体只有tos0metric</p>
<p>五类主体有</p>
<p>net mask外部路由的子网掩码</p>
<p>tos0metric外部路由的花费</p>
<p>e type引入的是一类还是二类外部路由</p>
<p>forwarding address 0.0.0.0表示去往引入路由目的地址的数据应该发给谁，类似下一跳地址，如果该项为0.0.0.0，则意思为下一跳是asbr</p>
<p>tag 1用来区分路由，是一个附加信息</p>
<h2 id="ospf路由计算"><a href="#ospf路由计算" class="headerlink" title="ospf路由计算"></a>ospf路由计算</h2><p>每条链路都有cost值</p>
<p>所以每条路由都有cost</p>
<p>区域外的路由先由abr算出来，再发布</p>
<p>区域外的路由分为type 1和type 2，type 1是igp路由，type 2是egp路由</p>
<h3 id="选择顺序"><a href="#选择顺序" class="headerlink" title="选择顺序"></a>选择顺序</h3><p>1.首选同区域的，即一二类lsa，再比cost</p>
<p>2.首选区域间的，同为区域间则优选骨干区域，还一样比cost</p>
<p>3.外部路由优选tpye 1的，在比cost</p>
<p>4.type 2路由比cost，相等则比asbr的cost</p>
<p>5.都相等就添加等值路由</p>
<h3 id="为ospf赋值cost"><a href="#为ospf赋值cost" class="headerlink" title="为ospf赋值cost"></a>为ospf赋值cost</h3><p>进入端口/vlan</p>
<p>ospf cost 值</p>
<h1 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h1><h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">将对方设置为对等体</span><br><span class="line">peer 对等体ip as-number as号</span><br><span class="line"></span><br><span class="line">强制向对方发送通告时下一跳改成自己</span><br><span class="line">peer 对等体ip nexthoplocal</span><br></pre></td></tr></table></figure>
<h2 id="报文种类"><a href="#报文种类" class="headerlink" title="报文种类"></a>报文种类</h2><h3 id="open"><a href="#open" class="headerlink" title="open"></a>open</h3><p>建立连接用于协商</p>
<h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><p>通告bgp信息</p>
<h3 id="notification"><a href="#notification" class="headerlink" title="notification"></a>notification</h3><p>错误</p>
<h3 id="keepalive"><a href="#keepalive" class="headerlink" title="keepalive"></a>keepalive</h3><p>保持连接</p>
<h2 id="连接建立过程"><a href="#连接建立过程" class="headerlink" title="连接建立过程"></a>连接建立过程</h2><h3 id="idle"><a href="#idle" class="headerlink" title="idle"></a>idle</h3><p>初始状态，启动事件开始后，初始化资源，发起tcp连接</p>
<h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><p>发起tcp连接，如果超时则保持connect并继续发tcp连接</p>
<h3 id="active"><a href="#active" class="headerlink" title="active"></a>active</h3><p>尝试tcp连接，不成功就退回connect</p>
<h3 id="open-sent"><a href="#open-sent" class="headerlink" title="open-sent"></a>open-sent</h3><p>tcp连接建立成功，发送open报文未收到回复，收到后，检查对等体的open，若可以接受，立刻发keepalive，否则退回idle</p>
<h3 id="open-confirm"><a href="#open-confirm" class="headerlink" title="open-confirm"></a>open-confirm</h3><p>等待对方keepalive，若等到了，进入establish，超时回到idle</p>
<h3 id="establish"><a href="#establish" class="headerlink" title="establish"></a>establish</h3><p>建立成功，开始发undate</p>
<h2 id="路由聚合"><a href="#路由聚合" class="headerlink" title="路由聚合"></a>路由聚合</h2><p>先network原本的路由</p>
<p>同时通告聚合路由和原本路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aggregate 聚合网段 聚合掩码</span><br></pre></td></tr></table></figure>
<p>不通告原本路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aggregate 聚合网段 聚合掩码 detail-supperssed</span><br></pre></td></tr></table></figure>
<h2 id="BGP路由基本属性"><a href="#BGP路由基本属性" class="headerlink" title="BGP路由基本属性"></a>BGP路由基本属性</h2><p>bgp属性分为：必遵/非必遵</p>
<p>过渡/非过渡</p>
<p>必遵是必须带有的属性</p>
<p>过渡是出了AS还起作用的，非过渡出去后会被还原为默认值</p>
<h3 id="origin"><a href="#origin" class="headerlink" title="origin"></a>origin</h3><p>必遵，过渡</p>
<p>定义路由信息的来源，IGP，EGP或者Incomplete，并按I，E，In的顺序选择路由</p>
<p>IGP指AS内部产生的，比如直接network的路由</p>
<p>通过其它IGP得到的路由为Incomplete</p>
<p>EGP是通过EGP得到的</p>
<h3 id="as-path"><a href="#as-path" class="headerlink" title="as-path"></a>as-path</h3><p>必遵，过渡</p>
<p>列出到达所通告的网络之前经过的as清单</p>
<p>会选as-path少的路径</p>
<h3 id="next-hop"><a href="#next-hop" class="headerlink" title="next-hop"></a>next-hop</h3><p>必遵，过渡</p>
<p>本地bgp在通告ibgp对等体时，不会更改下一跳</p>
<p>通告ebgp对等体时，会将下一跳改为自己和它相连的口</p>
<p>多路访问……</p>
<h2 id="路由策略"><a href="#路由策略" class="headerlink" title="路由策略"></a>路由策略</h2><h3 id="访问控制列表acl"><a href="#访问控制列表acl" class="headerlink" title="访问控制列表acl"></a>访问控制列表acl</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer 对等体ip filter-policy 路由策略名字 方向(export|import)</span><br></pre></td></tr></table></figure>
<p>acl是由permit/deny语句组成的一系列有顺序的规则</p>
<p>分为基本列表和高级列表两种</p>
<p>基本列表是只能基于源ip</p>
<p>高级列表可以基于更多，如源ip，目的ip等等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acl number acl号</span><br><span class="line">rule 规则号 permit或deny source 地址 掩码</span><br></pre></td></tr></table></figure>
<p>使用列表时，要指定端口，并且指定方向</p>
<p>方向为入，说明这个口的报文进入时需要进访问控制</p>
<p>方向为出，说明这个口发报文时需要控制</p>
<p>访问列表中的deny会删掉所有符合的报文，permit会删掉不符合的</p>
<p>最后一句最好以permit any结尾，表明漏网的都放过</p>
<h3 id="自治系统路径信息访问列表as-path-list"><a href="#自治系统路径信息访问列表as-path-list" class="headerlink" title="自治系统路径信息访问列表as-path list"></a>自治系统路径信息访问列表as-path list</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer 对等体ip as-path-acl 路由策略名字 方向(export|import)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip as-path-acl 序号 permit或deny as系统正则表达式</span><br></pre></td></tr></table></figure>
<p>正则表达式符号：</p>
<p>^表示字符串的开始</p>
<p>$表示字符串的结束</p>
<p>.包含空格在内的任意字符</p>
<p>+前面字符的一次或多次</p>
<p>_一个符号，逗号，空格，连接号</p>
<p>*0次或多次</p>
<p>?只能匹配前面一个字符的0次或多次</p>
<p>-连接符</p>
<p>|逻辑或</p>
<p>\b是as号码间的分隔符</p>
<p>注意是倒着的，比如从200出发，到300，再到400的通告，as-path为400 300 200</p>
<h3 id="路由策略-1"><a href="#路由策略-1" class="headerlink" title="路由策略"></a>路由策略</h3><p>对等体路由策略</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer 对等体ip route-policy 路由策略名字 方向(export|import)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">route-policy 名字 permit node 10//节点号可以有很多</span><br><span class="line">if-match 匹配规则</span><br><span class="line">if-match as-path aspath匹配规则号</span><br><span class="line">apply cost 数字</span><br><span class="line">apply local-preference 数字</span><br></pre></td></tr></table></figure>
<h2 id="BGP同步"><a href="#BGP同步" class="headerlink" title="BGP同步"></a>BGP同步</h2><p>一个bgp不会将从内部BGP对等体得到的路由信息通知给外部对等体，除非该路由信息也能通过IGP得知(内部网关协议)</p>
<p>比如对等体告诉了到A的路由，但自己不知道去A该怎么走，就不会告诉别人这条路由存在</p>
<p>解决同步的方法很多，最简单的一种是asbr把外界路由都引入到igp</p>
<p>也可以取消同步，之后强制改变下一跳</p>
<h1 id="ipv6"><a href="#ipv6" class="headerlink" title="ipv6"></a>ipv6</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>节点：所有运行ipv6的设备</p>
<p>主机：只能接受以自己为目的地址报文的节点</p>
<p>路由器：可以接受并转发不以自己为目的地报文的节点</p>
<p>局域网段：以二层交换设备为边界（类似局域网广播冲突域）</p>
<p>链路：以路由器为边界的一系列局域网段</p>
<p>子网：使用相同的64位IP地址的一个或多个链路，子网可以被其内部子网路由器进一步划分</p>
<p>邻接点：同一个链路上的物理或逻辑节点</p>
<p>链路MTU：一个链路上可以发送的最大传输单元</p>
<h2 id="ipv6地址"><a href="#ipv6地址" class="headerlink" title="ipv6地址"></a>ipv6地址</h2><p>点分十六进制</p>
<p>单播地址有全球地址和链路本地地址</p>
<p>还有组播和任博地址</p>
<p>::1为回环</p>
<h2 id="邻居发现协议nd"><a href="#邻居发现协议nd" class="headerlink" title="邻居发现协议nd"></a>邻居发现协议nd</h2><p>该协议实现了路由器发现，自动分配，地址解析，邻居不可达检测，重复地址检测等多种功能，ND定义了五种ICMPv6报文：</p>
<p>RS报文，路由器请求(Router Solicitation)：节点希望路由器立刻发送路由器宣告多播包以得到链路上路由器配置参数，不再等待周期性的路由器宣告其源地址是分配给发送主机的地址，若没有分配，则为全0，目的地址是所有路由器的多播地址(FF02::2)</p>
<p>RA报文，路由器通告(Router Advertisement)：路由器周期性发送，以通告其存在并让其它节点配置参数。若节点发送RS报文，路由器可以回复RA报文</p>
<p>NS报文，邻居请求(Neighbor Solicitation)：节点请求邻居的链路层地址，验证先前所获得并保存在缓存中的邻居链路层地址的可达性，或者验证其地址在本地链路上是否唯一源地址是发请求节点的单播地址，用作获取链路层地址时多播，可达性确认为单播</p>
<p>NA报文，邻居通告(Neighbor Notification)：是NS报文的回应</p>
<p>重定向报文(Redirect)：服务器通知主机，如果不是最佳的路由，则通知主机到达目的地的最佳下一跳</p>
<h3 id="加入组播组"><a href="#加入组播组" class="headerlink" title="加入组播组"></a>加入组播组</h3><p>配置了或启用了IPv6地址的计算机和路由器接口，会自动加入组播特定的组播地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看组播组：</span><br><span class="line">netsh</span><br><span class="line">interface</span><br><span class="line">ipv6</span><br><span class="line">show join</span><br></pre></td></tr></table></figure>
<p>主机会想要加入所有节点的组播地址：FF02:0:0:0:0:0:0:1</p>
<p>还会有其它的一些组播地址</p>
<p>相当于主机订阅了这个地址，会主动接受这个地址的信息</p>
<p>主机通过自动配置获得组播组的地址</p>
<p>发送MLD组播侦听者报文，宣告自己加入的组播组</p>
<p>路由器收到该报文，记录组播组成员身份</p>
<h3 id="邻居缓存表"><a href="#邻居缓存表" class="headerlink" title="邻居缓存表"></a>邻居缓存表</h3><p>pc中的邻居缓存表存在地址和mac地址的对应关系</p>
<p>一个表项中也存着邻居状态，不完整为不知道其mac，可到达为刚刚通信过，过一段时间会变为停滞</p>
<h3 id="地址解析"><a href="#地址解析" class="headerlink" title="地址解析"></a>地址解析</h3><p>需要知道某个地址的mac地址</p>
<p>首先在地址缓存表里建立表项，然后发ns报文</p>
<p>收到ns后回复na</p>
<p>收到na后添加到地址缓存表</p>
<h3 id="目的缓存表"><a href="#目的缓存表" class="headerlink" title="目的缓存表"></a>目的缓存表</h3><p>类似路由表，保存了到目标地址的下一跃点地址</p>
<h2 id="配主机ipv6"><a href="#配主机ipv6" class="headerlink" title="配主机ipv6"></a>配主机ipv6</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipv6 install</span><br><span class="line">ipv6 adu 5/2001::2</span><br><span class="line">ipv6 rtu ::/0 5/2001::1</span><br></pre></td></tr></table></figure>
<p>不是xp可以用图形界面配</p>
<h2 id="配交换机和路由器"><a href="#配交换机和路由器" class="headerlink" title="配交换机和路由器"></a>配交换机和路由器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">全局使能ipv6</span><br><span class="line">ipv6</span><br><span class="line"></span><br><span class="line">进入端口</span><br><span class="line">ipv6 enable</span><br><span class="line">ipv6 address 1::1/64</span><br><span class="line">undo ipv6 nd ra halt // 打开邻居公告</span><br></pre></td></tr></table></figure>
<p>ping命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping ipv6 地址</span><br></pre></td></tr></table></figure>
<p>ipv6静态路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipv6 route-static 目的 掩码 下一跳</span><br></pre></td></tr></table></figure>
<h2 id="ospfv3"><a href="#ospfv3" class="headerlink" title="ospfv3"></a>ospfv3</h2><p>同样有主干非主干区域，有相同的区域id和router id</p>
<p>同样的报文类型和邻接关系建立机制</p>
<p>基本相同的lsa和老化机制</p>
<p>相同的域内，域间和外部路由算法</p>
<p>不同的是ospfv3不再依赖具体的ip层协议</p>
<p>有专门配置的路由器id</p>
<p>网络地址相关内容在lsa的载荷中</p>
<p>下一跳使用链路本地地址，而非全局ip地址</p>
<p>lsa增加了组播，链路和域内前置三种新的lsa，为了以后增加了一种未定义的第七类lsa</p>
<h3 id="link-lsa"><a href="#link-lsa" class="headerlink" title="link-lsa"></a>link-lsa</h3><p>为每个链路生成一个lsa，在本地链路范围内传播</p>
<h3 id="intra-area-prefix-lsa"><a href="#intra-area-prefix-lsa" class="headerlink" title="intra-area-prefix-lsa"></a>intra-area-prefix-lsa</h3><p>由于router和network lsa不再带网络地址相关内容，所以有该类型的lsa传递其它区域的网络信息</p>
<h3 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ospfv3 1</span><br><span class="line">router-id 路由器id</span><br><span class="line"></span><br><span class="line">进入各端口</span><br><span class="line">ospfv3 1 area 对应区域号</span><br></pre></td></tr></table></figure>
<h2 id="BGP4"><a href="#BGP4" class="headerlink" title="BGP4+"></a>BGP4+</h2><p>配置方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//router-id</span><br><span class="line">bgp 100</span><br><span class="line">router-id 1.1.1.1</span><br><span class="line"></span><br><span class="line">//peer正常配，不过要在ipv6里enable</span><br><span class="line">peer 1::2 as-n 200</span><br><span class="line">ipv6-family</span><br><span class="line">peer 1::2 enable</span><br><span class="line"></span><br><span class="line">//network也只能在ipv6里</span><br><span class="line">network 4::1 128</span><br></pre></td></tr></table></figure>
<p>查看方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dis bgp ipv6 peer</span><br><span class="line">dis bgp ipv6 rou</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/11/15/BNF范式/" rel="next" title="BNF范式">
                <i class="fa fa-chevron-left"></i> BNF范式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/12/24/软件工程-1/" rel="prev" title="软件工程">
                软件工程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jameci</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#基础命令"><span class="nav-number">1.</span> <span class="nav-text">基础命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#display"><span class="nav-number">1.1.</span> <span class="nav-text">display</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.2.</span> <span class="nav-text">?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#debugging"><span class="nav-number">1.3.</span> <span class="nav-text">debugging</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据链路层实验"><span class="nav-number">2.</span> <span class="nav-text">数据链路层实验</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#冲突域"><span class="nav-number">2.1.</span> <span class="nav-text">冲突域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#广播域"><span class="nav-number">2.2.</span> <span class="nav-text">广播域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MAC表和ARP表"><span class="nav-number">2.3.</span> <span class="nav-text">MAC表和ARP表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ARP表"><span class="nav-number">2.3.1.</span> <span class="nav-text">ARP表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ARP表的作用"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">ARP表的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ARP表的形成"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">ARP表的形成</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MAC表"><span class="nav-number">2.3.2.</span> <span class="nav-text">MAC表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MAC表的作用"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">MAC表的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MAC表的学习"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">MAC表的学习</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#划分Vlan"><span class="nav-number">2.4.</span> <span class="nav-text">划分Vlan</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三种不同属性的端口"><span class="nav-number">2.4.1.</span> <span class="nav-text">三种不同属性的端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转发帧"><span class="nav-number">2.4.2.</span> <span class="nav-text">转发帧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vlan配置命令"><span class="nav-number">2.4.3.</span> <span class="nav-text">vlan配置命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PPP协议分析"><span class="nav-number">2.5.</span> <span class="nav-text">PPP协议分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络层实验"><span class="nav-number">3.</span> <span class="nav-text">网络层实验</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2，3层综合实验"><span class="nav-number">3.1.</span> <span class="nav-text">2，3层综合实验</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OSPF"><span class="nav-number">4.</span> <span class="nav-text">OSPF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本命令"><span class="nav-number">4.1.</span> <span class="nav-text">基本命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本知识"><span class="nav-number">4.2.</span> <span class="nav-text">基本知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#router-id"><span class="nav-number">4.2.1.</span> <span class="nav-text">router id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ospf多进程"><span class="nav-number">4.2.2.</span> <span class="nav-text">ospf多进程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五种报文类型"><span class="nav-number">4.3.</span> <span class="nav-text">五种报文类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hello"><span class="nav-number">4.3.1.</span> <span class="nav-text">Hello</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DD报文"><span class="nav-number">4.3.2.</span> <span class="nav-text">DD报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSR报文"><span class="nav-number">4.3.3.</span> <span class="nav-text">LSR报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSU报文"><span class="nav-number">4.3.4.</span> <span class="nav-text">LSU报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSAac报文"><span class="nav-number">4.3.5.</span> <span class="nav-text">LSAac报文</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#邻居状态机"><span class="nav-number">4.4.</span> <span class="nav-text">邻居状态机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Down"><span class="nav-number">4.4.1.</span> <span class="nav-text">Down</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Attempt"><span class="nav-number">4.4.2.</span> <span class="nav-text">Attempt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Init"><span class="nav-number">4.4.3.</span> <span class="nav-text">Init</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-way"><span class="nav-number">4.4.4.</span> <span class="nav-text">2-way</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ExStart"><span class="nav-number">4.4.5.</span> <span class="nav-text">ExStart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ExChang"><span class="nav-number">4.4.6.</span> <span class="nav-text">ExChang</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Loading"><span class="nav-number">4.4.7.</span> <span class="nav-text">Loading</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Full"><span class="nav-number">4.4.8.</span> <span class="nav-text">Full</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态转移图"><span class="nav-number">4.4.9.</span> <span class="nav-text">状态转移图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#报文交互过程"><span class="nav-number">4.4.10.</span> <span class="nav-text">报文交互过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Hello发现邻居"><span class="nav-number">4.4.10.1.</span> <span class="nav-text">Hello发现邻居</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主从关系协商"><span class="nav-number">4.4.10.2.</span> <span class="nav-text">主从关系协商</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DD报文交换"><span class="nav-number">4.4.10.3.</span> <span class="nav-text">DD报文交换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LSA请求"><span class="nav-number">4.4.10.4.</span> <span class="nav-text">LSA请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LSA更新"><span class="nav-number">4.4.10.5.</span> <span class="nav-text">LSA更新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LSA应答"><span class="nav-number">4.4.10.6.</span> <span class="nav-text">LSA应答</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OSPF的网络类型"><span class="nav-number">4.5.</span> <span class="nav-text">OSPF的网络类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#广播类型"><span class="nav-number">4.5.1.</span> <span class="nav-text">广播类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NBMA类型"><span class="nav-number">4.5.2.</span> <span class="nav-text">NBMA类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PTMP类型"><span class="nav-number">4.5.3.</span> <span class="nav-text">PTMP类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#点到点PTP类型"><span class="nav-number">4.5.4.</span> <span class="nav-text">点到点PTP类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#链路状态描述"><span class="nav-number">4.6.</span> <span class="nav-text">链路状态描述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stub-net"><span class="nav-number">4.6.1.</span> <span class="nav-text">Stub net</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PPP"><span class="nav-number">4.6.2.</span> <span class="nav-text">PPP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#点到多点"><span class="nav-number">4.6.3.</span> <span class="nav-text">点到多点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二类LSA和DR选举"><span class="nav-number">4.7.</span> <span class="nav-text">第二类LSA和DR选举</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DR选举"><span class="nav-number">4.7.1.</span> <span class="nav-text">DR选举</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全连接网络描述"><span class="nav-number">4.7.2.</span> <span class="nav-text">全连接网络描述</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#链路状态通告LSA的结构"><span class="nav-number">4.8.</span> <span class="nav-text">链路状态通告LSA的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#首部"><span class="nav-number">4.8.1.</span> <span class="nav-text">首部</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主体"><span class="nav-number">4.8.2.</span> <span class="nav-text">主体</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#区域划分"><span class="nav-number">4.9.</span> <span class="nav-text">区域划分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#路由器的类型"><span class="nav-number">4.9.1.</span> <span class="nav-text">路由器的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#学习AS外部路由"><span class="nav-number">4.9.2.</span> <span class="nav-text">学习AS外部路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#骨干区域"><span class="nav-number">4.9.3.</span> <span class="nav-text">骨干区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚连接"><span class="nav-number">4.9.4.</span> <span class="nav-text">虚连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三类LSA"><span class="nav-number">4.9.5.</span> <span class="nav-text">三类LSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四类和五类"><span class="nav-number">4.9.6.</span> <span class="nav-text">四类和五类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ospf路由计算"><span class="nav-number">4.10.</span> <span class="nav-text">ospf路由计算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#选择顺序"><span class="nav-number">4.10.1.</span> <span class="nav-text">选择顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为ospf赋值cost"><span class="nav-number">4.10.2.</span> <span class="nav-text">为ospf赋值cost</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BGP"><span class="nav-number">5.</span> <span class="nav-text">BGP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本配置"><span class="nav-number">5.1.</span> <span class="nav-text">基本配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#报文种类"><span class="nav-number">5.2.</span> <span class="nav-text">报文种类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#open"><span class="nav-number">5.2.1.</span> <span class="nav-text">open</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#update"><span class="nav-number">5.2.2.</span> <span class="nav-text">update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#notification"><span class="nav-number">5.2.3.</span> <span class="nav-text">notification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keepalive"><span class="nav-number">5.2.4.</span> <span class="nav-text">keepalive</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#连接建立过程"><span class="nav-number">5.3.</span> <span class="nav-text">连接建立过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#idle"><span class="nav-number">5.3.1.</span> <span class="nav-text">idle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#connect"><span class="nav-number">5.3.2.</span> <span class="nav-text">connect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#active"><span class="nav-number">5.3.3.</span> <span class="nav-text">active</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#open-sent"><span class="nav-number">5.3.4.</span> <span class="nav-text">open-sent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#open-confirm"><span class="nav-number">5.3.5.</span> <span class="nav-text">open-confirm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#establish"><span class="nav-number">5.3.6.</span> <span class="nav-text">establish</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由聚合"><span class="nav-number">5.4.</span> <span class="nav-text">路由聚合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP路由基本属性"><span class="nav-number">5.5.</span> <span class="nav-text">BGP路由基本属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#origin"><span class="nav-number">5.5.1.</span> <span class="nav-text">origin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#as-path"><span class="nav-number">5.5.2.</span> <span class="nav-text">as-path</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#next-hop"><span class="nav-number">5.5.3.</span> <span class="nav-text">next-hop</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由策略"><span class="nav-number">5.6.</span> <span class="nav-text">路由策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#访问控制列表acl"><span class="nav-number">5.6.1.</span> <span class="nav-text">访问控制列表acl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自治系统路径信息访问列表as-path-list"><span class="nav-number">5.6.2.</span> <span class="nav-text">自治系统路径信息访问列表as-path list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由策略-1"><span class="nav-number">5.6.3.</span> <span class="nav-text">路由策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP同步"><span class="nav-number">5.7.</span> <span class="nav-text">BGP同步</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ipv6"><span class="nav-number">6.</span> <span class="nav-text">ipv6</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本概念"><span class="nav-number">6.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ipv6地址"><span class="nav-number">6.2.</span> <span class="nav-text">ipv6地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#邻居发现协议nd"><span class="nav-number">6.3.</span> <span class="nav-text">邻居发现协议nd</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#加入组播组"><span class="nav-number">6.3.1.</span> <span class="nav-text">加入组播组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#邻居缓存表"><span class="nav-number">6.3.2.</span> <span class="nav-text">邻居缓存表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#地址解析"><span class="nav-number">6.3.3.</span> <span class="nav-text">地址解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#目的缓存表"><span class="nav-number">6.3.4.</span> <span class="nav-text">目的缓存表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配主机ipv6"><span class="nav-number">6.4.</span> <span class="nav-text">配主机ipv6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配交换机和路由器"><span class="nav-number">6.5.</span> <span class="nav-text">配交换机和路由器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ospfv3"><span class="nav-number">6.6.</span> <span class="nav-text">ospfv3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#link-lsa"><span class="nav-number">6.6.1.</span> <span class="nav-text">link-lsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#intra-area-prefix-lsa"><span class="nav-number">6.6.2.</span> <span class="nav-text">intra-area-prefix-lsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置方法"><span class="nav-number">6.6.3.</span> <span class="nav-text">配置方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP4"><span class="nav-number">6.7.</span> <span class="nav-text">BGP4+</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jameci</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
